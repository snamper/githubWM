define(function(require,exports,module){var h=require("http://a.myhd.wumeiwang.com/hdgw/model/domains/dist/domains.js");require("http://a.myhd.wumeiwang.com/hdgw/model/wmarea/css/style.css");var d=require("http://a.myhd.wumeiwang.com/hdgw/model/lib/jquery/seajs-jquery-1.8.3.min.js"),c=require("http://a.myhd.wumeiwang.com/hdgw/model/lib/juicer/seajs-juicer-min.js"),e=require("http://a.myhd.wumeiwang.com/hdgw/model/wmbox/dist/wmbox.js"),f=require("http://a.myhd.wumeiwang.com/hdgw/model/wmarea/dist/area_data_relationship.js"),b=require("http://a.myhd.wumeiwang.com/hdgw/model/wmarea/dist/area_data.js");var a=function(j){var i=c(['<div class="chk_area_head">','<a href="#" class="close">×</a>',"<h3>选择区域</h3>","</div>",'<div class="area_province">',"<ul>","{@each relationship as list,index}",'<li class="area_item clearfix">','<span class="floatleft w70">','<input type="checkbox" class="chk_item chkedsub" id="area_${key}_${index}" /><label class="chk_key" for="area_${key}_${index}"><b>${list.name}</b></label>',"</span>",'<div class="floatleft w480 provincelist" data_ids="{@each list.cityList as item}${item},{@/each}">',"</div>","</li>","{@/each}","</ul>","</div>",'<div class="btns">','<a href="#" class="ui_btn ui_btn_h27gray8 submit"><span class="ui_btn_txt">确定</span></a>',"</div>",].join(""));i=d(i.render(j));i.find(".provincelist").each(function(){var p=d(this);var o=p.attr("data_ids");o=o.substr(0,o.lastIndexOf(",")).split(",");p.empty();for(var m in o){var q=d(['<div class="province_box">',"<span>",'<input type="checkbox" class="chk_item province_item" data_name="'+b.data_province[o[m]]+'" data_id="'+o[m]+'" id="province_'+j.key+"_"+o[m]+'" />','<label class="chk_key" for="province_'+j.key+"_"+o[m]+'">'+b.data_province[o[m]]+"</label>",'<b class="sum"></b>','<a href="#" class="wm_ico arrow9down showcity"></a>',"</span>",'<div class="city_list"><ul><a href="#" class="cityhide">×</a></ul></div>',"</div>"].join(""));var l=q.find(".city_list ul");var n=b.data_city[o[m]];for(var k in n){l.append('<li><input type="checkbox" class="city_item" id="city_'+j.key+"_"+n[k].value+'" data_name="'+n[k].name+'" data_id="'+n[k].value+'" /><label for="city_'+j.key+"_"+n[k].value+'">'+n[k].name+"</label></li>")}p.append(q)}});return i};var g=function(m){var i=this;var j=d.extend({},m);var l={key:parseInt(Math.random()*999)+100,relationship:f};var k=e.invBox({boxCls:"chk_area_box",content:a(l),callback:function(){var n=this;this.close=function(){n.hide()}}});k.close=function(){i.hide()};k.wmBox.on("change",".chkedsub",function(){var o=d(this),n=o.closest(".area_item");if(o.attr("checked")){n.find(".province_item:enabled").attr("checked","checked").change()}else{n.find(".province_item:enabled").removeAttr("checked").change()}});k.wmBox.on("click",".showcity",function(){var o=d(this),n=o.closest(".area_province");n.find(".province_box_showcity").removeClass("province_box_showcity");o.closest(".province_box").addClass("province_box_showcity");return false});k.wmBox.on("change",".province_item",function(){var p=d(this),o=p.closest(".province_box").find(".city_list"),n=p.closest(".area_item");if(p.attr("checked")){o.find(".city_item:enabled").attr("checked","checked")}else{o.find(".city_item:enabled").removeAttr("checked")}if(n.find(".province_item").length===n.find(".province_item:checked").length){n.find(".chkedsub").attr("checked","checked")}else{n.find(".chkedsub").removeAttr("checked")}});k.wmBox.on("change",".city_item",function(){var n=d(this),o=n.closest(".province_box");if(n.attr("checked")&&o.find(".city_item").length===o.find(".city_item:checked").length){o.find(".province_item:enabled").attr("checked","checked")}else{o.find(".province_item:enabled").removeAttr("checked")}});k.wmBox.on("change",".province_item,.city_item",function(){var o=d(this),p=o.closest(".province_box"),n=p.find(".sum"),q=p.find(".city_item:checked").length;n.empty();if(q){n.append("("+q+")")}});k.wmBox.on("click",".cityhide",function(){var n=d(this);n.closest(".province_box").removeClass("province_box_showcity");return false});k.wmBox.on("click",".submit",function(){var n=d(this);i.hide();typeof j.submitCallback==="function"&&j.submitCallback.call(i);return false});this.Box=k.wmBox;this.getVal=function(){var n={};n.cityList=[];n.provinceList=[];k.wmBox.find(".city_item:checked").each(function(){var o=d(this);n.cityList.push({id:o.attr("data_id"),name:o.attr("data_name")})});k.wmBox.find(".province_item:checked").each(function(){var o=d(this);n.provinceList.push({id:o.attr("data_id"),name:o.attr("data_name")})});return n};this.show=function(n){typeof j.callback==="function"&&j.callback.call(i);typeof n==="function"&&n.call(i);k.show()};this.hide=function(){k.hide()};this.close=function(){k.close()};this.empty=function(){i.Box.remove();k.mask.remove()};this.provinceList=k.wmBox.find(".province_box");this.areaBoxList=k.wmBox.find(".area_item");typeof j.callback==="function"&&j.callback.call(this)};return function(i){return new g(i)}});
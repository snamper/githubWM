define(function(require,exports,module){var f=require("http://a.myhd.wumeiwang.com/hdgw/model/domains/dist/domains.js");var b=require("jquery"),d=require("lib"),a=require("wmverification");var e=function(){var g=b(".wmlogin_form"),h=b("#user_name"),i=d.cookie("wm.user.username");window.document.domain="hdgw.com";h.val(i||"").focus();a.init(g,function(){this.setTipSkin("white1").setDirection("tl").setOffSet({left:200,top:-5}).strikingSuccess=false});c();h.attr("tabindex","1");g.find(":password").attr("tabindex","2")};var c=function(){var h=b(".wmlogin_form");var j,m,g,l=false,i;var k=function(o,p){b.ajax({url:f.account+"/accountExists",data:{username:encodeURI(o)},type:"get",dataType:"json",success:function(q){typeof p==="function"&&p(q)}})};var n=function(o,p){b.ajax({url:f.account+"/CheckAuthCode",data:{vcode:o},type:"get",dataType:"json",success:function(q){typeof p==="function"&&p(q)}})};h.on("click",".login_btn",function(){var r=b(this);var q=b("[name='username']"),o=b("[for='"+q.attr("name")+"']"),p=b.trim(q.val());if(!a.verify()){return false}if(!l){k(p,function(s){if(!s.response){l=false;o.empty().append('<i class="wm_ico fork2"></i>用户名不存在！')}else{l=true;i=s.attachment.userid;o.empty();r.click()}});return false}b.ajax({url:"/login",type:"post",data:{username:i,password:h.find("[name='password']").val(),authcode:h.find(".v_code_txt").val()},dataType:"json",success:function(s){if(s.response){window.top.location.reload()}else{if(s.attachment.require_authcode&&!h.find(".v_code_txt").length){h.find("#pw_row").after('<li class="form_row"><label class="row_key">验证码：</label><input type="text" class="form_txt w100 v_code_txt" wmv="empty" wmvmsg="验证码不能为空！" tabindex="3"><img src="'+f.account+'/auth" class="mrl5 v_code_img" title="点击更换" style="vertical-align: middle;" /></li>')}alert(s.attachment.message)}},error:function(){alert("服务器正忙，请稍后再试！")}});return false});h.find("[name='username']").on("change",function(){var q=b(this),o=b("[for='"+q.attr("name")+"']"),p=b.trim(q.val());if(p){o.empty().append('<i class="loading18_18_1"></i>正在检测登录名').css("display","inline-block");k(p,function(r){if(!r.response){l=false;o.empty().append('<i class="wm_ico fork2"></i>用户名不存在！')}else{if(r.attachment.require_authcode&&!h.find(".v_code_txt").length){h.find("#pw_row").after('<li class="form_row"><label class="row_key">验证码：</label><input type="text" class="form_txt w100 v_code_txt" wmv="empty" wmvmsg="验证码不能为空！" tabindex="3"><img src="'+f.account+'/auth" class="mrl5 v_code_img" title="点击更换" style="vertical-align: middle;" /></li>')}l=true;i=r.attachment.userid;o.empty()}})}});h.on("keypress",function(o){if(o.keyCode==13){b(".login_btn").click()}});h.on("click",".go_reg",function(){top.location.href=f.account+"/register";return false});h.on("blur",".v_code_txt",function(){var q=b(this),p=b.trim(q.val()),o;if(p){n(p,function(r){if(!r.response){o=q.data("v_code_tips");if(!o){o=new tips({ele:q,con:"验证码错误！",skin:"white1",direction:"tl",offset:{left:270,top:-5}});q.data("v_code_tips",o)}o.show();h.find(".v_code_img").click()}})}});h.on("focus",".v_code_txt",function(){var p=b(this),o;o=p.data("v_code_tips");o&&o.hide()});h.on("click",".v_code_img",function(){b(this).attr("src",f.account+"/auth?t="+new Date().getTime());return false})};e()});
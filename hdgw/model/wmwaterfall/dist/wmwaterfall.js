define(function(require,exports,module){var b=require("http://a.myhd.wumeiwang.com/hdgw/model/domains/dist/domains.js");var c=require("http://a.myhd.wumeiwang.com/hdgw/model/lib/jquery/seajs-jquery-1.8.3.min.js");var a=function(h){var l=this;var d=c.extend({listEle:".waterfall_list",itemEle:".waterfall_item",spacing:20},h);var e=0,i;var k,g=0,m=0;var j=function(n,p){var o=n.find("img").length;e=0;if(o===0){typeof p==="function"&&p();return}n.find("img").on("error",function(){c(this).attr("src","http://a.myhd.wumeiwang.com/hdgw/view/public/img/img404_1.png")});if(navigator.appName=="Microsoft Internet Explorer"){n.find("img").each(function(){var q=new Image();q.onreadystatechange=function(){if(q.readyState=="complete"){e++;e===o&&typeof p==="function"&&p()}};q.src=c(this).attr("src")})}else{n.find("img").load(function(){e++;e===o&&typeof p==="function"&&p()})}};var f=function(p,q){var r=q||false,n,o=0;p.css({position:"absolute"});p.each(function(u){var w=c(this),t=w.outerWidth(),v=w.outerHeight(),s=Number.MAX_VALUE;if(r){l.$List.find("[bott]").each(function(){var x=c(this);s=Math.min(s,x.attr("bott")-0)});n=l.$List.find("[bott='"+s+"']:eq(0)").removeAttr("bott");g=s;m=n.attr("left")-0}else{g=0;m=w.index()*(t+l.Spacing);r=m+t*2+l.Spacing*2>=k}w.css({top:g,left:m}).attr("bott",g+v+l.Spacing).attr("left",m).attr("top",g);m+=t+l.Spacing});l.$List.find("[bott]").each(function(){var s=c(this);o=Math.max(o,s.attr("bott")-0)});l.$List.height(o)};this.$List=c(d.listEle);this.$Item=c(d.itemEle);this.Spacing=d.spacing;this.reset=function(){l.$List=c(d.listEle);l.$Item=c(d.itemEle);k=l.$List.width(),g=0,m=0;l.$Item.css({top:0,left:0}).removeAttr("left").removeAttr("bott");f(l.$Item)};this.append=function(p,q){if(!(p instanceof c)){p=c(p)}var o=l.$List.find("[bott]");l.$List.append(p);l.$Item=c(d.itemEle);if(!o.length){j(p,function(){l.reset();typeof q==="function"&&q.call(l.$List)})}else{var n=-1;j(p,function(){m=0;o.each(function(){n=Math.max(n,parseFloat(c(this).attr("top")));m=Math.max(m,parseFloat(c(this).attr("left")))});f(p,n>0);typeof q==="function"&&q.call(l.$List)})}};this.getMaxBott=function(){var n=0;l.$List.find("[bott]").each(function(){n=Math.max(n,parseFloat(c(this).attr("bott")))});return n};this.stuff=function(){var n=l.$Item.last().clone().empty();var o=l.getMaxBott();n.css({top:0,left:0}).removeAttr("bott").removeAttr("left").removeAttr("top").addClass("waterallstuff");l.$List.find("[bott]").each(function(){var p=n.clone();if(c(this).attr("bott")!=o){l.append(p,function(){p.removeAttr("bott");p.css({display:"block",height:o-(p.attr("top")-0)-l.Spacing})})}})};l.$List.css({position:"relative"});l.reset()};exports.create=function(d){return new a(d)}});
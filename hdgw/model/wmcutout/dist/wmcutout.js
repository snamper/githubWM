define(function(require,exports,module){var a=require("http://a.myhd.wumeiwang.com/hdgw/model/domains/dist/domains.js");var d=require("http://a.myhd.wumeiwang.com/hdgw/model/lib/jquery/seajs-jquery-1.8.3.min.js"),e=require("../../wmmove/dist/wmmove.js"),b=require("../../wmchangewhbox/dist/wmchangewhbox.js");var c=function(m){var f=this;var l;var g=d.extend({parentBox:".cutout_parent",cutoutRangeEle:".cutout_range",cutoutSourceEle:".cutout_source",cutoutLimitEle:".cutout_limit",cutoutPreviewEle:".previewitem",changewh:false},m);var i=function(){var p=this;var o=f.$cutoutSource.width(),n=f.$cutoutSource.height();f.$cutoutPreview.each(function(){var t=d(this).data("imgClone");var s=o/t.width(),q=n/t.height;var r=o/n;t.css({"margin-top":-(p.position.top/q),"margin-left":-(p.position.left/s)})})};var h=function(){var o,q,n,p;f.$cutoutSource.width("auto");f.$cutoutSource.height("auto");o=f.$cutoutSource.outerWidth(),q=f.$cutoutSource.outerHeight(),n=Math.max(o,q);if(n===o){f.$cutoutSource.width(f.maxWidth-2)}if(n===q){f.$cutoutSource.height(f.maxHeight-2)}o=f.$cutoutSource.width();q=f.$cutoutSource.height();f.$cutoutSource.width(o);f.$cutoutSource.height(q);f.$cutoutLimit.width(o);f.$cutoutLimit.height(q);p=Math.min(o,q);f.$cutoutRange.width(p);f.$cutoutRange.height(p);f.limit=p};var j=function(){l=e.create({moveEle:g.cutoutRangeEle,parentEle:g.cutoutLimitEle,moveOffset:{top:-21,left:-21},event:g.event,mousemoveCallback:function(){var o=this;var n=this.$moveBox.position();i.call({position:n,width:o.$moveBox.width(),height:o.$moveBox.height()})}});if(g.changewh){b.create({changeEle:g.cutoutRangeEle,paeentBox:g.cutoutLimitEle,changeBtnDownCallback:function(){l.stop=true},changeBtnUpCallback:function(){l.stop=false},changePX:function(){var s=this;var p,r,o,q,n;n=(this.pageX-this.offsetX-this.outerWidth)+(this.pageY-this.offsetY-this.outerHeight);o=s.width+n/2,q=s.height+n/2;p=s.$paeentBox.outerWidth();r=s.$paeentBox.outerHeight();if(s.parentTop+q>r){o=q=r-s.parentTop}if(s.parentLeft+o>p){q=o=p-_parentLeft}return{Width:o,Height:q}},changeBtnMousemoveCallback:function(){var o=this;var n=this.$changeBox.position();i.call({position:n,width:o.width,height:o.height})}})}k()};var k=function(){f.$cutoutSource.load(function(){h();var o,q,p,n;o=f.$cutoutSource.width();q=f.$cutoutSource.height();p=Math.min(o,q);n=o/q;f.$cutoutPreview.each(function(){var v=d(this);var y=f.$cutoutSource.clone();var x=o,t=q;var z=v.width(),u=v.height(),r=Math.min(u,z),s,w;if(z<o&&u<q){x=x*(z/x);t=x*(u/t)}if(z>o){x=z;t=x/n}else{}if(u>t){t=u;x=t*n}y.css({width:x,height:t});v.data("imgClone",y);v.empty().append(y)})});f.$cutoutSource.load()};this.$parentBox=d(g.parentBox);this.$cutoutRange=d(g.cutoutRangeEle);this.$cutoutPreview=d(g.cutoutPreviewEle);this.$cutoutLimit=this.$cutoutRange.closest(g.cutoutLimitEle);this.$cutoutSource=this.$parentBox.find(g.cutoutSourceEle);this.maxWidth=this.$parentBox.width();this.maxHeight=this.$parentBox.height();this.limit=0;this.setCutoutSource=function(n){if(!n){return false}if(typeof n.src==="string"){f.$cutoutSource.attr("src",n.src);f.$cutoutSource.load()}};this.stop=function(n){l.stop=n};j()};exports.create=function(f){return new c(f)}});